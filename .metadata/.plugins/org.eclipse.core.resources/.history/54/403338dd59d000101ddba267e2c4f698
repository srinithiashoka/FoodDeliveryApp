<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="com.foodapp.dao.impl.OrderDAOImpl" %>
<%@ page import="com.foodapp.model.Order" %>
<%@ page import="com.foodapp.model.User" %>
<%@ page import="jakarta.servlet.http.HttpSession" %>

<%
    User user = (User) session.getAttribute("user"); // session is implicit
    int orderId = 0;

    String orderParam = request.getParameter("orderId");
    if(orderParam != null){
        try { orderId = Integer.parseInt(orderParam); } 
        catch(NumberFormatException e){ orderId = 0; }
    }

    Order order = null;
    if(orderId > 0) {
        OrderDAOImpl orderDAO = new OrderDAOImpl();
        order = orderDAO.getOrderById(orderId);
    }
%>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Track Order</title>
<style>
body { font-family:"Segoe UI",sans-serif; background:#f9f9f9; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; }
h1 { color:#ff4757; margin-top:40px; }
.order-container { background:#fff; padding:20px; margin-top:30px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.1); width:90%; max-width:600px; }
.order-row { display:flex; justify-content:space-between; margin:10px 0; font-size:1rem; }
.order-status { font-weight:bold; color:#2ed573; }
.btn { margin-top:20px; padding:10px 18px; background:#ff4757; color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold; transition:background 0.3s; }
.btn:hover { background:#ff6b81; }

/* Toast */
#toast {
    visibility:hidden;
    min-width:180px;
    max-width:300px;
    background-color:#2ed573;
    color:white;
    text-align:center;
    border-radius:8px;
    padding:12px 16px;
    position:fixed;
    z-index:9999;
    top:20px;
    right:20px;
    font-size:14px;
    opacity:0;
    transition:opacity 0.3s, visibility 0.3s;
    box-shadow:0 2px 6px rgba(0,0,0,0.2);
}
#toast.show { visibility:visible; opacity:1; }
</style>
</head>
<body>

<div id="toast"></div>

<h1>Track Your Order</h1>

<div class="order-container">
<% if(order != null){ %>
    <div class="order-row"><span>Order ID:</span><span>#<%= order.getOrderId() %></span></div>
    <div class="order-row"><span>Restaurant ID:</span><span>#<%= order.getRestaurantId() %></span></div>
    <div class="order-row"><span>Order Date:</span><span><%= order.getOrderDate() %></span></div>
    <div class="order-row"><span>Total Amount:</span><span>â‚¹<%= String.format("%.2f", order.getTotalAmount()) %></span></div>
    <div class="order-row"><span>Payment Mode:</span><span><%= order.getPaymentMode() %></span></div>
    <div class="order-row"><span>Status:</span><span class="order-status" id="orderStatus"><%= order.getStatus() %></span></div>
    <button class="btn" onclick="window.location.href='home.jsp'">Back to Home</button>
<% } else { %>
    <p style="text-align:center;">Order not found!</p>
    <button class="btn" onclick="window.location.href='home.jsp'">Go Home</button>
<% } %>
</div>

<script>
// Show toast only if order exists
<% if(order != null){ %>
const toast = document.getElementById('toast');
toast.innerText = "Tracking Order #<%= order.getOrderId() %>";
toast.className = 'show';
setTimeout(() => { toast.className = toast.className.replace('show',''); }, 3000);
<% } %>
</script>

</body>
</html>
